{
  "agent": {
    "region": "${region}",
    "metrics_collection_interval": 10
  },
  "metrics": {
    "namespace": "${cloudwatch_namespace}",
    "append_dimensions": {
      "InstanceId": "$${aws:InstanceId}",
      "AutoScalingGroupName": "$${aws:AutoScalingGroupName}"
    },
    "aggregation_dimensions": [["InstanceId"], ["AutoScalingGroupName"]],
    "metrics_collected": {
      "disk": {
        "resources": ["/"],
        "measurement": ["disk_used_percent"]
      },
      "swap": {
        "measurement": ["swap_used_percent"]
      },
      "mem": {
        "measurement": ["mem_used_percent"]
      }
    }
  },
  "logs": {
    "metrics_collected": {
      "prometheus": {
        "log_group_name": "${prometheus_log_group_name}",
        "prometheus_config_path": "/etc/prometheus/config.yml",
        "emf_processor": {
          "metric_declaration_dedup": true,
          "metric_namespace": "Concourse-Prometheus",
          "metric_unit": {
            "concourse_builds_aborted_total": "Count",
            "concourse_builds_check_aborted_total": "Count",
            "concourse_builds_check_errored_total": "Count",
            "concourse_builds_check_failed_total": "Count",
            "concourse_builds_check_finished_total": "Count",
            "concourse_builds_check_started_total": "Count",
            "concourse_builds_check_succeeded_total": "Count",
            "concourse_builds_errored_total": "Count",
            "concourse_builds_failed_total": "Count",
            "concourse_builds_finished_total": "Count",
            "concourse_builds_started_total": "Count",
            "concourse_builds_succeeded_total": "Count",
            "concourse_caches_get_step_cache_hits": "Count",
            "concourse_caches_streamed_resource_caches": "Count",
            "concourse_db_queries_total": "Count",
            "concourse_gc_created_containers_to_be_garbage_collected": "Count",
            "concourse_gc_created_volumes_to_be_garbage_collected": "Count",
            "concourse_gc_creating_containers_to_be_garbage_collected": "Count",
            "concourse_gc_destroying_containers_to_be_garbage_collected": "Count",
            "concourse_gc_destroying_volumes_to_be_garbage_collected": "Count",
            "concourse_gc_failed_containers_to_be_garbage_collected": "Count",
            "concourse_gc_failed_volumes_to_be_garbage_collected": "Count",
            "concourse_jobs_scheduled_total": "Count",
            "concourse_lidar_checks_enqueued_total": "Count",
            "concourse_lidar_checks_started_total": "Count",
            "concourse_volumes_orphaned_volumes_to_be_deleted": "Count",
            "concourse_volumes_volumes_streamed": "Count",
            "go_memstats_alloc_bytes_total": "Bytes",
            "go_memstats_frees_total": "Count",
            "go_memstats_lookups_total": "Count",
            "go_memstats_mallocs_total": "Count",
            "process_cpu_seconds_total": "Seconds",
            "concourse_builds_check_running": "Count",
            "concourse_builds_running": "Count",
            "concourse_jobs_scheduling": "Count",
            "go_goroutines": "Count",
            "go_memstats_alloc_bytes": "Bytes",
            "go_memstats_buck_hash_sys_bytes": "Bytes",
            "go_memstats_gc_sys_bytes": "Bytes",
            "go_memstats_heap_alloc_bytes": "Bytes",
            "go_memstats_heap_idle_bytes": "Bytes",
            "go_memstats_heap_inuse_bytes": "Bytes",
            "go_memstats_heap_objects": "Count",
            "go_memstats_heap_released_bytes": "Bytes",
            "go_memstats_heap_sys_bytes": "Bytes",
            "go_memstats_last_gc_time_seconds": "Seconds",
            "go_memstats_mcache_inuse_bytes": "Bytes",
            "go_memstats_mcache_sys_bytes": "Bytes",
            "go_memstats_mspan_inuse_bytes": "Bytes",
            "go_memstats_mspan_sys_bytes": "Bytes",
            "go_memstats_next_gc_bytes": "Bytes",
            "go_memstats_other_sys_bytes": "Bytes",
            "go_memstats_stack_inuse_bytes": "Bytes",
            "go_memstats_stack_sys_bytes": "Bytes",
            "go_memstats_sys_bytes": "Bytes",
            "go_threads": "Count",
            "process_max_fds": "Count",
            "process_open_fds": "Count",
            "process_resident_memory_bytes": "Bytes",
            "process_start_time_seconds": "Seconds",
            "process_virtual_memory_bytes": "Bytes",
            "process_virtual_memory_max_bytes": "Bytes",
            "promhttp_metric_handler_requests_in_flight": "Count",
            "concourse_builds_latest_completed_build_status": "Count",
            "concourse_concurrent_requests": "Count",
            "concourse_concurrent_requests_limit_hit_total": "Count",
            "concourse_db_connections": "Count",
            "concourse_http_responses_duration_seconds": "Seconds",
            "concourse_lidar_check_queue_size": "Count",
            "concourse_lidar_checks_finished_total": "Count",
            "concourse_locks_held": "Count",
            "concourse_tasks_wait_duration": "Seconds",
            "concourse_tasks_waiting": "Count",
            "concourse_workers_containers": "Count",
            "concourse_workers_tasks": "Count",
            "concourse_workers_volumes": "Count",
            "concourse_workers_registered": "Count",
            "go_info": "Count",
            "promhttp_metric_handler_requests_total": "Count",
            "go_gc_duration_seconds": "Seconds",
            "go_memstats_gc_cpu_fraction": "Percent"
          },
          "metric_declaration": [
            {
              "source_labels": ["job"],
              "label_matcher": "concourse",
              "metric_selectors": [
                "^concourse_builds_aborted_total$",
                "^concourse_builds_check_aborted_total$",
                "^concourse_builds_check_errored_total$",
                "^concourse_builds_check_failed_total$",
                "^concourse_builds_check_finished_total$",
                "^concourse_builds_check_started_total$",
                "^concourse_builds_check_succeeded_total$",
                "^concourse_builds_errored_total$",
                "^concourse_builds_failed_total$",
                "^concourse_builds_finished_total$",
                "^concourse_builds_started_total$",
                "^concourse_builds_succeeded_total$",
                "^concourse_caches_get_step_cache_hits$",
                "^concourse_caches_streamed_resource_caches$",
                "^concourse_db_queries_total$",
                "^concourse_gc_created_containers_to_be_garbage_collected$",
                "^concourse_gc_created_volumes_to_be_garbage_collected$",
                "^concourse_gc_creating_containers_to_be_garbage_collected$",
                "^concourse_gc_destroying_containers_to_be_garbage_collected$",
                "^concourse_gc_destroying_volumes_to_be_garbage_collected$",
                "^concourse_gc_failed_containers_to_be_garbage_collected$",
                "^concourse_gc_failed_volumes_to_be_garbage_collected$",
                "^concourse_jobs_scheduled_total$",
                "^concourse_lidar_checks_enqueued_total$",
                "^concourse_lidar_checks_started_total$",
                "^concourse_volumes_orphaned_volumes_to_be_deleted$",
                "^concourse_volumes_volumes_streamed$",
                "^go_memstats_alloc_bytes_total$",
                "^go_memstats_frees_total$",
                "^go_memstats_lookups_total$",
                "^go_memstats_mallocs_total$",
                "^process_cpu_seconds_total$",
                "^concourse_builds_check_running$",
                "^concourse_builds_running$",
                "^concourse_jobs_scheduling$",
                "^go_goroutines$",
                "^go_memstats_alloc_bytes$",
                "^go_memstats_buck_hash_sys_bytes$",
                "^go_memstats_gc_sys_bytes$",
                "^go_memstats_heap_alloc_bytes$",
                "^go_memstats_heap_idle_bytes$",
                "^go_memstats_heap_inuse_bytes$",
                "^go_memstats_heap_objects$",
                "^go_memstats_heap_released_bytes$",
                "^go_memstats_heap_sys_bytes$",
                "^go_memstats_last_gc_time_seconds$",
                "^go_memstats_mcache_inuse_bytes$",
                "^go_memstats_mcache_sys_bytes$",
                "^go_memstats_mspan_inuse_bytes$",
                "^go_memstats_mspan_sys_bytes$",
                "^go_memstats_next_gc_bytes$",
                "^go_memstats_other_sys_bytes$",
                "^go_memstats_stack_inuse_bytes$",
                "^go_memstats_stack_sys_bytes$",
                "^go_memstats_sys_bytes$",
                "^go_threads$",
                "^process_max_fds$",
                "^process_open_fds$",
                "^process_resident_memory_bytes$",
                "^process_start_time_seconds$",
                "^process_virtual_memory_bytes$",
                "^process_virtual_memory_max_bytes$",
                "^promhttp_metric_handler_requests_in_flight$",
                "^concourse_builds_latest_completed_build_status$",
                "^concourse_concurrent_requests$",
                "^concourse_concurrent_requests_limit_hit_total$",
                "^concourse_db_connections$",
                "^concourse_http_responses_duration_seconds$",
                "^concourse_lidar_check_queue_size$",
                "^concourse_lidar_checks_finished_total$",
                "^concourse_locks_held$",
                "^concourse_tasks_wait_duration$",
                "^concourse_tasks_waiting$",
                "^concourse_workers_containers$",
                "^concourse_workers_tasks$",
                "^concourse_workers_volumes$",
                "^concourse_workers_registered$",
                "^go_info$",
                "^promhttp_metric_handler_requests_total$",
                "^go_gc_duration_seconds$",
                "^go_memstats_gc_cpu_fraction$"
              ],
              "dimensions": [
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["host"],
                ["teamName", "pipelineName", "jobName"],
                ["host", "action"],
                ["host", "action"],
                ["host", "dbname"],
                ["host", "method", "route", "status"],
                ["host"],
                ["host", "status"],
                ["host", "type"],
                ["host", "platform", "teamId", "workerTags"],
                ["host", "platform", "teamId", "workerTags"],
                ["host", "platform", "worker", "tags", "team"],
                ["host", "platform", "worker", "tags", "team"],
                ["host", "platform", "worker", "tags", "team"],
                ["host", "state"],
                ["host", "version"],
                ["host", "code"],
                ["host", "quantile"],
                ["host"]
              ]
            }
          ]
        }
      }
    }
  }
}
