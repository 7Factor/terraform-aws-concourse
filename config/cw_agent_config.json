{
  "agent": {
    "region": "${region}",
    "metrics_collection_interval": 10
  },
  "metrics": {
    "namespace": "${cloudwatch_namespace}",
    "append_dimensions": {
      "InstanceId": "$${aws:InstanceId}",
      "AutoScalingGroupName": "$${aws:AutoScalingGroupName}"
    },
    "aggregation_dimensions": [["InstanceId"], ["AutoScalingGroupName"]],
    "metrics_collected": {
      "disk": {
        "resources": ["/"],
        "measurement": ["disk_used_percent"]
      },
      "swap": {
        "measurement": ["swap_used_percent"]
      },
      "mem": {
        "measurement": ["mem_used_percent"]
      }
    }
  },
  "logs": {
    "metrics_collected": {
      "prometheus": {
        "log_group_name": "${prometheus_log_group_name}",
        "prometheus_config_path": "/etc/prometheus/config.yml",
        "emf_processor": {
          "metric_declaration_dedup": true,
          "metric_namespace": "Concourse-Prometheus",
          "metric_unit": {
            "concourse_builds_aborted_total": "Count",
            "concourse_builds_errored_total": "Count",
            "concourse_builds_failed_total": "Count",
            "concourse_builds_finished_total": "Count",
            "concourse_builds_latest_completed_build_status": "Count",
            "concourse_builds_running": "Count",
            "concourse_builds_started_total": "Count",
            "concourse_builds_succeeded_total": "Count",
             "concourse_concurrent_requests": "Count",
             "concourse_concurrent_requests_limit_hit_total": "Count",
            "concourse_db_connections": "Count",
            "concourse_db_queries_total": "Count",
             "concourse_http_responses_duration_seconds": "Seconds",
            "concourse_jobs_scheduled_total": "Count",
            "concourse_jobs_scheduling": "Count",
            "concourse_lidar_check_queue_size": "Count",
            "concourse_lidar_checks_enqueued_total": "Count",
             "concourse_lidar_checks_finished_total": "Count",
            "concourse_lidar_checks_started_total": "Count",
            "concourse_locks_held": "Count",
             "concourse_tasks_wait_duration": "Seconds",
             "concourse_tasks_waiting": "Count",
            "concourse_volumes_volumes_streamed": "Count",
             "concourse_workers_containers": "Count",
             "concourse_workers_registered": "Count",
             "concourse_workers_tasks": "Count",
             "concourse_workers_volumes": "Count",
            "go_gc_duration_seconds": "Seconds",
            "go_goroutines": "Count",
            "go_info": "Count",
            "go_memstats_alloc_bytes": "Bytes",
            "go_memstats_alloc_bytes_total": "Bytes",
            "go_memstats_buck_hash_sys_bytes": "Bytes",
            "go_memstats_frees_total": "Count",
            "go_memstats_gc_cpu_fraction": "Percent",
            "go_memstats_gc_sys_bytes": "Bytes",
            "go_memstats_heap_alloc_bytes": "Bytes",
            "go_memstats_heap_idle_bytes": "Bytes",
            "go_memstats_heap_inuse_bytes": "Bytes",
            "go_memstats_heap_objects": "Count",
            "go_memstats_heap_released_bytes": "Bytes",
            "go_memstats_heap_sys_bytes": "Bytes",
            "go_memstats_last_gc_time_seconds": "Seconds",
            "go_memstats_lookups_total": "Count",
            "go_memstats_mallocs_total": "Count",
            "go_memstats_mcache_inuse_bytes": "Bytes",
            "go_memstats_mcache_sys_bytes": "Bytes",
            "go_memstats_mspan_inuse_bytes": "Bytes",
            "go_memstats_mspan_sys_bytes": "Bytes",
            "go_memstats_next_gc_bytes": "Bytes",
            "go_memstats_other_sys_bytes": "Bytes",
            "go_memstats_stack_inuse_bytes": "Bytes",
            "go_memstats_stack_sys_bytes": "Bytes",
            "go_memstats_sys_bytes": "Bytes",
            "go_threads": "Count",
            "process_cpu_seconds_total": "Seconds",
            "process_max_fds": "Count",
            "process_open_fds": "Count",
            "process_resident_memory_bytes": "Bytes",
            "process_start_time_seconds": "Seconds",
            "process_virtual_memory_bytes": "Bytes",
            "process_virtual_memory_max_bytes": "Bytes",
            "promhttp_metric_handler_requests_in_flight": "Count",
             "promhttp_metric_handler_requests_total": "Count"
          },
          "metric_declaration": [
            {
              "metric_selectors": [
                "^concourse_db_connections$",
                "^go_info$"
              ],
              "dimensions": [
                ["dbname"],
                ["version"]
              ]
            },
            {
              "metric_selectors": ["^concourse_locks_held$"],
              "dimensions": [["type"]]
            }
          ]
        }
      }
    }
  }
}
